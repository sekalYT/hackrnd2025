❓ Часто Задаваемые Вопросы (FAQ)

В: Я получаю ошибку Ошибка: токен не найден... при запуске команд. О: Это означает, что CLI не смог найти ваш персональный токен доступа (PAT) SourceCraft. Убедитесь, что вы:

Выполнили src auth login и вставили действительный PAT.

Или установили переменную окружения SOURCECRAFT_TOKEN.

Проверили, что ваш файл конфигурации (обычно ~/.config/src/config.yaml или в текущей папке) существует и содержит строку token:, если вы использовали auth login (небезопасная версия).

В: Команды repo list или repo create возвращают HTML (<!DOCTYPE html>...) или ошибку non-JSON response. О: Обычно это указывает на проблему с аутентификацией или адресом API:

Недействительный токен: Ваш PAT мог истечь или быть отозван. Выполните src auth logout, а затем src auth login с действительным токеном.

Неправильный URL API: Проверьте настройку api_base_url. Выполните src config get api_base_url. Значение должно быть https://sourcecraft.dev/api/v1. Если оно другое, исправьте с помощью src config set api_base_url https://sourcecraft.dev/api/v1.

В: Я получаю ошибку 404 Not Found, часто с сообщением Cannot POST /api/v1/... или workflow '' not found. О: Это означает, что сервер не нашел конкретный API эндпоинт.

Для repo create: Может указывать на проблему на стороне сервера с эндпоинтом POST /orgs/.../repos или на проблему с правами доступа. Проверьте, можете ли вы создавать репозитории через веб-интерфейс.

Для workflow run: Убедитесь, что имя workflow (например, main) точно совпадает с именем файла (без .yml) в папке .sourcecraft/ci/ вашего репозитория, и что этот файл был отправлен на сервер (git push). Используйте правильное имя (main, без .yml). Подождите несколько минут после push, чтобы система CI распознала файл. Также проверьте путь API в internal/api/client.go.

Общее: Убедитесь, что api_base_url правильный (https://sourcecraft.dev/api/v1).

В: Команды repo sync или pr create сообщают, что не удалось определить репозиторий. О: Эти команды пытаются определить репозиторий по вашему Git remote с именем origin. Убедитесь, что:

Вы запускаете команду внутри вашего локального клона Git-репозитория.

У вас настроен remote с именем origin, указывающий на ваш репозиторий SourceCraft (например, git@sourcecraft.dev:your-org/your-repo.git). Проверьте с помощью git remote -v.

Либо используйте флаг --repo <org>/<repo>, чтобы явно указать репозиторий для команды.

В: Как получить User ID (UUID) для команды access role add/remove? О: CLI не имеет команды для поиска UUID пользователей. Вам нужно найти UUID в веб-интерфейсе SourceCraft.dev, обычно на странице профиля пользователя или в списке участников организации/репозитория.

В: Почему нет команд security scan, secrets list, package publish и т.д.? О: CLI может реализовать только те функции, которые доступны через REST API SourceCraft. На основе предоставленной спецификации OpenAPI (Swagger), эндпоинты для этих функций в настоящее время отсутствуют.

В: Где сохраняется мой файл конфигурации? О: По умолчанию CLI ищет config.yaml в текущей директории (.), а затем в ~/.config/src/ (где ~ — ваша домашняя директория). Вы можете увидеть, какой файл используется, запустив команду с флагом -v (verbose), например, src -v repo list. Вы также можете указать другой путь с помощью глобального флага --config.

В: Мой токен хранится безопасно? О: Нет. Текущая реализация (после отката) хранит токен в открытом виде в файле config.yaml. Это небезопасно. Для большей безопасности рассмотрите возможность повторной реализации аутентификации с использованием системных хранилищ учетных данных (например, macOS Keychain, Windows Credential Manager, Linux Secret Service) через библиотеку вроде go-keyring.